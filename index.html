<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>MK Mini App</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- TON Connect -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }

    button {
      padding: 12px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }

    #donate-zone {
      position: relative;
      z-index: 10;
    }

    #ton-connect {
      margin-top: 20px;
    }
  </style>
</head>

<body>

  <h1>üöÄ MK</h1>
  <p>Telegram Mini App</p>

  <p>üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> MK</p>

  <!-- DONATE -->
  <div id="donate-zone">
    <button onclick="donateTON()">üíé –î–æ–Ω–∞—Ç TON</button>
  </div>

  <!-- TON CONNECT -->
  <button onclick="openWallet()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</button>
  <div id="ton-connect"></div>
  <p id="wallet"></p>

  <!-- SCRIPT -->
  <script>
    const tg = Telegram.WebApp;
    tg.expand();

    // ===== BALANCE =====
    let balance = localStorage.getItem("mk_balance");
    if (!balance) {
      balance = 0;
      localStorage.setItem("mk_balance", balance);
    }
    document.getElementById("balance").innerText = balance;

    function addBalance(amount) {
      balance = parseInt(balance) + amount;
      localStorage.setItem("mk_balance", balance);
      document.getElementById("balance").innerText = balance;
    }

    // ===== DONATE TON =====
    function donateTON() {
      const address = "UQBOekw_iNJGJNSZgTZkHTjOB_FqsGOOS_VG8n0oQzwitABM"; // –¢–í–û–ô TON –ê–î–†–ï–°
      const tonAmount = 0.5;

      const tonLink = ton://transfer/${address}?amount=${tonAmount * 1e9};
      window.open(tonLink, "_blank");

      // –Ω–∞—á–∏—Å–ª—è–µ–º MK (–ø—Ä–∏–º–µ—Ä)
      addBalance(50);
    }

    // ===== TON CONNECT =====
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: "https://mk-app.vercel.app/tonconnect-manifest.json"
    });

    function openWallet() {
      tonConnectUI.openModal();
    }

    tonConnectUI.onStatusChange(wallet => {
      if (wallet) {
        document.getElementById("wallet").innerText =
          "–ö–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω: " + wallet.account.address;
      }
    });
  </script>

</body>
  </html>
